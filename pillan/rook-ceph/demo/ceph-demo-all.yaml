---
apiVersion: v1
kind: Namespace
metadata:
  name: ceph-demo-all
---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: rook-cephfs
# Change "rook-ceph" provisioner prefix to match the operator namespace if needed
provisioner: rook-ceph.cephfs.csi.ceph.com
parameters:
  # clusterID is the namespace where operator is deployed.
  clusterID: rook-ceph

  # CephFS filesystem name into which the volume shall be created
  fsName: scratch

  # Ceph pool into which the volume shall be created
  # Required for provisionVolume: "true"
  pool: scratch-data0

  # The secrets contain Ceph admin credentials. These are generated automatically by the operator
  # in the same namespace as the cluster.
  csi.storage.k8s.io/provisioner-secret-name: rook-csi-cephfs-provisioner
  csi.storage.k8s.io/provisioner-secret-namespace: rook-ceph
  csi.storage.k8s.io/controller-expand-secret-name: rook-csi-cephfs-provisioner
  csi.storage.k8s.io/controller-expand-secret-namespace: rook-ceph
  csi.storage.k8s.io/node-stage-secret-name: rook-csi-cephfs-node
  csi.storage.k8s.io/node-stage-secret-namespace: rook-ceph
reclaimPolicy: Delete
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: ceph-demo-all-pvc1
  namespace: ceph-demo-all
spec:
  storageClassName: rook-ceph-block
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 200Gi
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: ceph-demo-all-pvc2
  namespace: ceph-demo-all
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 200Gi
  storageClassName: rook-cephfs
---
apiVersion: v1
kind: Pod
metadata:
  name: ceph-demo-all
  namespace: ceph-demo-all
  labels:
    app: ceph-demo-all
spec:
  containers:
    - name: alpine
      image: alpine
      command: ["/bin/sh", "-c", "trap : TERM INT; sleep infinity & wait"]
      volumeMounts:
        - name: pvc1
          mountPath: /data/pvc1
        - name: pvc2
          mountPath: /data/pvc2
        - name: auxtel
          mountPath: /data/auxtel
        - name: comcam
          mountPath: /data/comcam
        - name: jhome
          mountPath: /data/jhome
        - name: lsstdata
          mountPath: /data/lsstdata
        - name: obs-env
          mountPath: /data/obs-env
        - name: project
          mountPath: /data/project
        - name: scratch
          mountPath: /data/scratch
  volumes:
    - name: pvc1
      persistentVolumeClaim:
        claimName: ceph-demo-all-pvc1
    - name: pvc2
      persistentVolumeClaim:
        claimName: ceph-demo-all-pvc2
    - name: auxtel
      nfs:
        path: /auxtel
        server: nfs-auxtel.tu.lsst.org
    - name: comcam
      nfs:
        path: /comcam
        server: nfs-comcam.tu.lsst.org
    - name: jhome
      nfs:
        path: /jhome
        server: nfs-jhome.tu.lsst.org
    - name: lsstdata
      nfs:
        path: /lsstdata
        server: nfs-lsstdata.tu.lsst.org
    - name: obs-env
      nfs:
        path: /obs-env
        server: nfs-obsenv.tu.lsst.org
    - name: project
      nfs:
        path: /project
        server: nfs-project.tu.lsst.org
    - name: scratch
      nfs:
        path: /scratch
        server: nfs-scratch.tu.lsst.org
